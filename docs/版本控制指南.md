# RacerStats 版本控制指南

## 项目初始化（已完成）

项目已经初始化了 Git 版本控制系统：
- 初始提交：`97def99` - "初始项目提交 - RacerStats v1.0"
- 包含 109 个文件，7100+ 行代码

## 日常版本控制操作

### 1. 查看项目状态
```bash
# 查看当前文件修改状态
git status

# 查看提交历史（简洁版）
git log --oneline

# 查看详细提交历史
git log --graph --pretty=format:'%h -%d %s (%cr) <%an>'

# 查看所有分支
git branch -a

# 查看所有标签
git tag
```

### 2. 保存代码更改
```bash
# 查看修改了哪些内容
git diff

# 添加所有修改的文件
git add .

# 添加特定文件
git add app/src/main/java/com/example/racerstats/MainActivity.kt

# 提交更改（推荐格式）
git commit -m "功能: 描述具体修改内容"
git commit -m "修复: 解决的bug描述"  
git commit -m "优化: 性能或UI改进描述"

# 修改最后一次提交信息
git commit --amend -m "新的提交信息"
```

### 3. 版本标签管理
```bash
# 创建轻量标签
git tag v1.0.1

# 创建带注释的标签（推荐）
git tag -a v1.1.0 -m "版本 1.1.0 - 新增Vmax功能和速度优化"

# 为特定提交创建标签
git tag -a v1.0.0 97def99 -m "初始版本"

# 查看标签信息
git show v1.1.0

# 删除标签
git tag -d v1.0.1
```

## 版本回滚操作

### 1. 撤销工作区修改
```bash
# 撤销单个文件的修改
git checkout -- app/src/main/res/layout/activity_main.xml

# 撤销所有工作区修改
git checkout -- .

# 撤销已添加到暂存区的文件
git reset HEAD app/src/main/java/com/example/racerstats/MainActivity.kt
```

### 2. 回滚到历史版本
```bash
# 软回滚：保留文件修改，仅撤销提交
git reset --soft HEAD~1        # 撤销最近1次提交
git reset --soft HEAD~3        # 撤销最近3次提交

# 混合回滚：撤销提交和暂存，保留工作区修改
git reset --mixed HEAD~1       # 默认模式

# 硬回滚：完全回滚，丢失所有修改（危险操作！）
git reset --hard HEAD~1

# 回滚到指定提交ID
git reset --hard 97def99

# 回滚到指定标签
git reset --hard v1.0.0
```

### 3. 安全的回滚方法
```bash
# 创建新提交来撤销之前的修改（推荐）
git revert HEAD                 # 撤销最近一次提交
git revert 提交ID               # 撤销指定提交

# 临时保存当前修改
git stash                       # 暂存修改
git stash pop                   # 恢复暂存的修改
git stash list                  # 查看所有暂存
git stash drop                  # 删除最新暂存
```

## 分支管理

### 1. 功能开发分支
```bash
# 创建并切换到新分支
git checkout -b feature/speed-optimization
git checkout -b feature/vmax-ui
git checkout -b bugfix/crash-on-start

# 切换分支
git checkout master
git checkout feature/speed-optimization

# 查看当前分支
git branch

# 合并分支到master
git checkout master
git merge feature/speed-optimization

# 删除已合并的分支
git branch -d feature/speed-optimization
```

### 2. 紧急修复分支
```bash
# 从master创建hotfix分支
git checkout master
git checkout -b hotfix/critical-bug-fix

# 修复完成后合并
git checkout master
git merge hotfix/critical-bug-fix
git tag -a v1.0.1 -m "紧急修复版本"

# 删除hotfix分支
git branch -d hotfix/critical-bug-fix
```

## 比较和查看

### 1. 查看文件差异
```bash
# 查看工作区与暂存区差异
git diff

# 查看暂存区与最新提交差异
git diff --cached

# 查看两个提交之间差异
git diff 97def99 HEAD

# 查看两个分支差异
git diff master feature/speed-optimization

# 查看特定文件的历史修改
git log -p app/src/main/res/layout/activity_main.xml
```

### 2. 查看文件历史
```bash
# 查看文件的提交历史
git log --follow app/src/main/java/com/example/racerstats/MainActivity.kt

# 查看文件每行的最后修改信息
git blame app/src/main/java/com/example/racerstats/MainActivity.kt

# 查看特定提交的详细信息
git show 97def99
```

## 推荐的版本控制工作流

### 1. 日常开发流程
```bash
# 1. 开始新功能开发
git checkout master
git pull                        # 如果有远程仓库
git checkout -b feature/new-feature

# 2. 开发过程中定期提交
git add .
git commit -m "功能: 添加GPS精度显示"

# 3. 功能开发完成
git checkout master
git merge feature/new-feature
git tag -a v1.2.0 -m "版本 1.2.0 - 新增GPS精度显示"

# 4. 清理分支
git branch -d feature/new-feature
```

### 2. 版本发布流程
```bash
# 1. 准备发布
git checkout master
git add .
git commit -m "发布: 准备 v1.3.0 版本"

# 2. 创建发布标签
git tag -a v1.3.0 -m "版本 1.3.0 - 主要更新:
- 新增实时速度衰减动画
- 优化Vmax显示界面
- 修复GPS连接稳定性问题
- 性能优化和bug修复"

# 3. 生成APK并测试
./gradlew assembleRelease

# 4. 如果需要修复，创建补丁版本
git tag -a v1.3.1 -m "版本 1.3.1 - 修复版本 1.3.0 的关键bug"
```

## 紧急情况处理

### 1. 误操作恢复
```bash
# 如果刚执行了错误的reset
git reflog                      # 查看操作历史
git reset --hard HEAD@{1}      # 恢复到上一个状态

# 如果删除了重要文件
git checkout HEAD -- 文件名     # 从最新提交恢复文件
```

### 2. 冲突解决
```bash
# 合并时出现冲突
git merge feature/branch-name   # 会提示冲突文件

# 手动编辑冲突文件，然后
git add 解决冲突的文件
git commit -m "解决合并冲突"
```

## 最佳实践建议

### 1. 提交信息规范
- **功能**: 添加新功能
- **修复**: 修复bug
- **优化**: 性能或代码优化  
- **UI**: 界面调整
- **重构**: 代码重构
- **文档**: 文档更新
- **配置**: 配置文件修改

### 2. 提交频率
- 每个独立功能或修复应该是一个提交
- 避免一次提交包含多个不相关的修改
- 定期提交，不要积累太多修改

### 3. 分支策略
- `master`: 主分支，保持稳定
- `feature/*`: 功能开发分支
- `bugfix/*`: bug修复分支
- `hotfix/*`: 紧急修复分支

### 4. 标签管理
- 使用语义化版本号：v主版本.次版本.修订版本
- 主要功能更新：v1.0.0 → v1.1.0
- bug修复：v1.1.0 → v1.1.1
- 重大变更：v1.x.x → v2.0.0

## 备份到远程仓库（可选）

如果需要将代码备份到GitHub或其他平台：

```bash
# 添加远程仓库
git remote add origin https://github.com/你的用户名/RacerStats.git

# 首次推送
git push -u origin master
git push --tags

# 日常推送
git push                        # 推送代码
git push --tags                 # 推送标签
```

## 快速参考

| 操作 | 命令 |
|------|------|
| 查看状态 | `git status` |
| 提交更改 | `git add . && git commit -m "描述"` |
| 创建标签 | `git tag -a v1.0.0 -m "版本描述"` |
| 撤销修改 | `git checkout -- .` |
| 回滚提交 | `git reset --soft HEAD~1` |
| 查看历史 | `git log --oneline` |
| 创建分支 | `git checkout -b branch-name` |
| 合并分支 | `git merge branch-name` |

---

**重要提醒**: 
- 执行 `git reset --hard` 前务必确认，会永久丢失修改
- 定期创建标签，便于版本管理和回滚
- 重要功能开发前先创建分支